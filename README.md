# InvestTrader - 投资交易分析工具

本项目是一个基于Python的投资交易分析工具，主要用于基金和指数的数据分析、回测和操作建议生成。

## 功能介绍

### 1. 基金分析功能

- **单个基金回测** - 对指定基金的历史数据进行回测分析
- **批量基金回测** - 对Excel文件中列出的所有基金进行回测分析
- **单个基金操作建议** - 根据基金历史数据和预估涨跌幅提供操作建议
- **批量基金操作建议** - 自动生成Excel文件中所有基金的操作建议

### 2. 指数分析功能

- **指数回测** - 对指定指数的历史数据进行回测分析
- **指数操作建议** - 根据指数历史数据提供操作建议

### 3. 数据来源

- 基金数据：通过`efinance`库获取
- 指数数据：通过`yfinance`库获取

## 交易策略

### OptimizedTaStrategy 策略

[OptimizedTaStrategy](file://D:\Coding\source\repos\InvestTrader\trader.py#L791-L1307) 是一个基于技术分析的优化交易策略，结合了多种技术指标和成交量分析来判断市场趋势和交易时机。

#### 核心特征

1. **多指标融合判断**
   - 使用多周期均线系统（MA5/MA10/MA20）判断趋势方向
   - 结合EMA快慢线系统增强趋势判断可靠性
   - 利用ADX指标判断趋势强度
   - 集成MACD、RSI、KDJ等多种技术指标进行综合评分

2. **成交量分析**
   - 通过成交量与20日均量比值判断量能变化
   - 识别放量突破和缩量回调信号
   - 利用量价背离判断趋势反转可能性

3. **动态仓位管理**
   - 根据趋势强度调整加仓比例
   - 在强势上升趋势中积极加仓（最多2倍基础金额）
   - 在下跌趋势中分阶段减仓，保留底仓
   - 根据超买超卖状态调整交易力度

#### 交易逻辑

1. **强势上升趋势**
   - 条件：多均线多头排列、价格在均线上方、ADX>25、正动量
   - 操作：积极加仓，根据趋势强度调整仓位（1.0-2.0倍基础金额）
   - 放量突破时进一步增加仓位

2. **弱势上升趋势**
   - 条件：至少短期均线多头排列、价格在均线上方、正动量
   - 操作：稳健加仓，根据背离信号调整信心

3. **震荡市策略**
   - 条件：ADX<20或均线纠缠、低波动率
   - 操作：高抛低吸，低位买入高位卖出

4. **下降趋势**
   - 强势下跌：快速减仓
   - 弱势下跌：缓慢减仓
   - 根据成交量和背离信号调整减仓速度

#### 风险控制

- 保留历史最大持仓的10%作为底仓
- 设置最小现金缓冲
- 利用技术指标避免追涨杀跌
- 通过量价关系确认交易信号可靠性

## 使用方法

运行[main.py](file://D:\Coding\source\repos\InvestTrader\main.py)后，根据提示选择相应功能：

1. 获取<单个基金>历史数据并回测
2. 获取<所有基金>历史数据并回测
3. 获取<单个基金>历史数据并获取操作建议
4. 获取<所有基金>历史数据并获取操作建议
5. 获取<指数>历史数据并回测
6. 获取<指数>历史数据并获取操作建议

## 输出结果

- 回测功能会显示交易过程和最终收益情况
- 建议功能会生成操作建议并自动保存到Excel文件中


## 技术分析说明
### 1️⃣ 趋势判断

| 指标               | 含义               | 买入信号|
|-------------------|--------------|---------------------------------|
| MA (移动平均线)        | 衡量股价中期趋势	    |   短期均线向上穿越长期均线（黄金交叉）|
| MACD              | 价格动能和趋势结合	   |    DIF上穿DEA 且红柱放大|
| ADX (趋势强度)	       |      趋势是否强劲	 | ADX > 25 且 +DI > -DI |
| 布林带 (Bollinger Bands) | 	波动率与趋势结合	   |   股价突破上轨或下轨后的回调确认    |

### 2️⃣ 动能判断（Momentum Analysis）
| 指标               | 含义               | 买入信号|
|-------------------|--------------|---------------------------------|
|RSI (相对强弱指数)	|衡量短期买卖力量	|RSI 从 30 上穿 → 买入信号|
|ROC (Rate of Change)	|价格变化速率	|ROC 由负转正表示价格加速上涨|
|Volume (成交量)	|市场参与强度|	价格上涨 + 成交量放大 = 真突破|

#### 量化信号公式示例：
$$
Momentum Score = 0.4×RSI+0.6×MACD Histogram Slope
$$

### 3️⃣  风险评估（Risk Control）
| 指标               | 含义               | 判断标准|
|-------------------|--------------|---------------------------------|
|ATR (平均波幅)|	反映波动性|	越高风险越大|
|最大回撤 (Max Drawdown)|	历史下跌幅度|	控制在 -10%以内较稳健|
|Beta 系数	|相对市场波动性	|Beta < 1 稳定，>1 激进|
|止损点	|防止亏损扩大	|一般设在支撑位下方 2~3%|


### 4️⃣ 估值判断（Valuation Check）

| 指标               | 含义               | 判断逻辑 |
|-------------------|--------------|------|
|PE (市盈率)	|盈利价格比	|PE < 行业均值 = 低估|
|PB (市净率)	|净资产价格比	|PB < 1.5 通常较安全|
|PEG (市盈率相对增长比)	|成长性折算	|PEG < 1 表示被低估|

>   可结合行业比较，如： 
>   当前股票PE = 12，行业均值 = 18 → 低估 33% → 可建仓信号

### 买点确认（Entry Timing）
把以上信号综合在一起：

|阶段	|技术形态	|买点策略|
|-------------------|--------------|------|
|突破初期	|均线金叉 + 放量	|小仓位试探买入（20%仓）|
|趋势确立	|MACD红柱扩张、站稳MA20	|加仓（再30%仓）|
|回踩确认	|股价回踩MA10/MA20不破	|再加仓至满仓（50%仓）|
|顶背离出现	|RSI>70 且 MACD顶背离	|暂停加仓或部分止盈|

### 卖出信号计算 / Sell Signal

卖出信号通常是 买入信号的反向或趋势衰减。常用逻辑：

|方法	|技术指标	|卖出条件|
|-------------------|--------------|------|
趋势反转	|MA金叉/死叉	|短期均线向下穿过长期均线（死叉）|
动能减弱	|MACD	|DIF 下穿 DEA，MACD红柱转负|
超买信号	|RSI	|RSI > 70 → 可能超买，考虑卖出|
止盈/止损	|ATR 或固定百分比	|股价上涨到目标收益或下跌到止损线卖出|
成交量异常	|Volume	|放量下跌，短期趋势可能反转|